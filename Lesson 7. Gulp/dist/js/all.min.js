function Food(e){this.name=e}function SimpleFood(e,t,n){Food.call(this,e),this.price=t,this.calories=n}function CompositeFood(e,t){Food.call(this,e),this.parts=t}function Stuffing(e,t,n){SimpleFood.call(this,e,t,n)}function Topping(e,t,n){SimpleFood.call(this,e,t,n)}function HamburgerSize(e){this.name=e}function Hamburger(e,t,n,r){var o=new SimpleFood("Основа",n,r);if(CompositeFood.call(this,e,[o]),this.isStuffed=!1,!HamburgerSize.SIZES.some(function(e){return e.getName()===t.getName()}))throw new Exception("Такого размера гамбургеры у нас не делаются.");this.size=t}function BurgerCafe(e){this.address=e,this.yourHamburger=null}function CascadeMenu(e,t,n){BaseUiElement.call(this),this.setId(t),this.addClass(n),this.items=e}function MenuItem(e){BaseUiElement.call(this),this.content=e}function NestedMenuItem(e,t){MenuItem.call(this),this.caption=e,this.submenu=new CascadeMenu(t)}function CafeMenu(e,t){BaseUiElement.call(this),this.cafe=e,this.productsUrl=t,this.types=["hamburger","stuffing","topping"],this.loadingWrappers={},this.types.forEach(e=>this.loadingWrappers[e]=new LoadingWrapper(new MenuItem(new TextBlock("Loading menu"))))}function Gallery(e){BaseUiElement.call(this),this.sourceUrl=e,this.previewsLoaded=!1,this.galleryData=[],this.loadingWrapper=new LoadingWrapper(new TextBlock("Loading preview"))}function LoadingWrapper(e){BaseUiElement.call(this),this.placeholder=e,this.placeholderElement=null,this.isRendered=!1,this.isComplete=!1,this.completeContentProvider=null,this.wrapper=null}function Http(){}function UiException(e){Error.call(this,e)}function BaseUiElement(){this.id=null,this.classList=[],this.data={}}function Container(e){BaseUiElement.call(this),this.children=e||[],this.container=null}function Link(e,t){BaseUiElement.call(this),this.href=e,this.content=t}function TextBlock(e){BaseUiElement.call(this),this.text=e,this.span=null}function Image(e){BaseUiElement.call(this),this.source=e}function ActionLink(e,t){Link.call(this,"#",e),this.action=t}function Form(e,t,n){Container.call(this,n),this.url=e,this.method=t}function FormRow(e,t){BaseUiElement.call(this),this.label=e,this.input=t}function Label(e){BaseUiElement.call(this),this.text=e}function Popup(){}function ShoppingBasketItem(e,t){BaseUiElement.call(this),this.productId=e,this.count=t,this.price=null,this.name=null,this.isLoaded=!1}function ShoppingBasketContent(){BaseUiElement.call(this)}function ShoppingBasketPreview(){BaseUiElement.call(this)}function TextField(e,t,n,r){BaseUiElement.call(this),this.name=e,this.placeholder=t,this.validationRule=r,this.linesNumber=n||1}Food.prototype.calcPrice=function(){return 0},Food.prototype.calcCalories=function(){return 0},SimpleFood.prototype=Object.create(Food.prototype),SimpleFood.prototype.constructor=SimpleFood,SimpleFood.prototype.calcPrice=function(){return this.price},SimpleFood.prototype.calcCalories=function(){return this.calories},CompositeFood.prototype=Object.create(Food.prototype),CompositeFood.prototype.constructor=CompositeFood,CompositeFood.prototype.calcPrice=function(){return this.parts.reduce(function(e,t){return e+t.calcPrice()},0)},CompositeFood.prototype.calcCalories=function(){return this.parts.reduce(function(e,t){return e+t.calcCalories()},0)},Stuffing.prototype=Object.create(SimpleFood.prototype),Stuffing.prototype.constructor=Stuffing,Topping.prototype=Object.create(SimpleFood.prototype),Topping.prototype.constructor=Topping,HamburgerSize.BIG_SIZE=new HamburgerSize("Большой"),HamburgerSize.SMALL_SIZE=new HamburgerSize("Маленький"),HamburgerSize.SIZES=[HamburgerSize.BIG_SIZE,HamburgerSize.SMALL_SIZE],HamburgerSize.prototype.getName=function(){return this.name},Hamburger.prototype=Object.create(CompositeFood.prototype),Hamburger.prototype.constructor=Hamburger,Hamburger.prototype.chooseStuffing=function(e){return this.isStuffed?"Начинка уже была выбрана.":e instanceof Stuffing?(this.parts.push(e),this.isStuffed=!0,"Начинка выбрана."):"Данный продукт нельзя использовать в качестве начинки."},Hamburger.prototype.addTopping=function(e){return e instanceof Topping?this.parts.includes(e)?"Данный топпинг уже был добавлен.":(this.parts.push(e),"Топпинг добавлен."):"Данный продукт нельзя использовать в качестве топпинга."},Hamburger.prototype.removeTopping=function(e){if(e instanceof Topping){var t=this.parts.indexOf(e);return-1==t?"Данный топпинг не был добавлен.":(this.parts.splice(t,1),"Топпинг удален.")}return"Данный продукт нельзя использовать в качестве топпинга."},Hamburger.prototype.getName=function(){return this.size.getName()+" гамбургер"},Hamburger.prototype.checkOut=function(){return this.isStuffed?"Вы заказали "+this.getName()+". Ваш заказ стоит "+this.calcPrice()+" рублей и содержит "+this.calcCalories()+" калорий":"Вы ещё не выбрали начинку."},BurgerCafe.prototype.menu={SMALL_HAMBURGER:new Hamburger("Маленький гамбургер",HamburgerSize.SMALL_SIZE,50,20),BIG_HAMBURGER:new Hamburger("Большой гамбургер",HamburgerSize.BIG_SIZE,100,40),CHEESE_STUFFING:new Stuffing("Сыр",10,20),SALAD_STUFFING:new Stuffing("Салат",20,5),POTATO_STUFFING:new Stuffing("Картошка",15,10),TRUFFLE_STUFFING:new Stuffing("Трюфели",200,20),LOBSTER_STUFFING:new Stuffing("Лобстер",150,15),SPICIES_TOPPING:new Topping("Специи",15,0),MAYONNAISE_TOPPING:new Topping("Майонез",20,5)},BurgerCafe.prototype.spellAction=function(e){var t=document.getElementById("dialog"),n=document.createElement("p");n.innerHTML=e,t.appendChild(n)},BurgerCafe.prototype.checkHamburger=function(){return null!=this.yourHamburger||(this.spellAction("Вы не выбрали гамбургер."),!1)},BurgerCafe.prototype.createHamburger=function(e){null==this.yourHamburger?(this.yourHamburger=Object.create(e),this.spellAction("Вы заказали "+this.yourHamburger.getName()+".")):this.spellAction("У вас уже заказан "+this.yourHamburger.getName()+".")},BurgerCafe.prototype.chooseStuffing=function(e){this.checkHamburger()&&this.spellAction(this.yourHamburger.chooseStuffing(e))},BurgerCafe.prototype.addTopping=function(e){this.checkHamburger()&&this.spellAction(this.yourHamburger.addTopping(e))},BurgerCafe.prototype.removeTopping=function(e){this.checkHamburger()&&this.spellAction(this.yourHamburger.removeTopping(e))},BurgerCafe.prototype.checkOut=function(){this.checkHamburger()&&this.spellAction(this.yourHamburger.checkOut())},CascadeMenu.prototype=Object.create(BaseUiElement.prototype),CascadeMenu.prototype.constructor=CascadeMenu,CascadeMenu.prototype.render=function(){var e=document.createElement("ul");this.applyBaseProperties(e),e.classList.add("menu");for(var t=0;t<this.items.length;t++)e.appendChild(this.items[t].render());return e},MenuItem.prototype=Object.create(BaseUiElement.prototype),MenuItem.prototype.constructor=CascadeMenu,MenuItem.prototype.renderContent=function(){return this.content.render()},MenuItem.prototype.render=function(){var e=document.createElement("li");return this.applyBaseProperties(e),e.classList.add("menu-item"),e.appendChild(this.renderContent()),e},NestedMenuItem.prototype=Object.create(MenuItem.prototype),NestedMenuItem.prototype.constructor=NestedMenuItem,NestedMenuItem.prototype.renderContent=function(){var e=document.createElement("p");return e.appendChild(this.caption.render()),e.appendChild(this.submenu.render()),e},CafeMenu.prototype=Object.create(BaseUiElement.prototype),CafeMenu.prototype.constructor=CafeMenu,CafeMenu.prototype.loadTypesData=function(e){this.types.forEach(t=>{Http.get(this.productsUrl+"/?type="+t,(n,r)=>{if(n)throw new Error(n);var o=r.map(e=>this.createProduct(e));e(t,o)})})},CafeMenu.prototype.createProduct=function(e){switch(e.type){case"hamburger":var t=new HamburgerSize(e.properties.size);return new Hamburger(e.name,t,e.price,e.calories);case"stuffing":return new Stuffing(e.name,e.price,e.calories);case"topping":return new Topping(e.name,e.price,e.calories)}},CafeMenu.prototype.renderHamburgerMenu=function(e){var t=e.map(e=>new MenuItem(new ActionLink(new TextBlock(e.getName()+" "+e.calcPrice()+" р. "+e.calcCalories()+" кал."),()=>this.cafe.createHamburger(Object.create(e)))));return new NestedMenuItem(new TextBlock("Гамбургеры"),t).render()},CafeMenu.prototype.renderStuffingMenu=function(e){var t=[],n=[];e.forEach(e=>{var r=new MenuItem(new ActionLink(new TextBlock(e.name+" "+e.price+" р. "+e.calories+" кал."),()=>this.cafe.chooseStuffing(e)));e.price>100?n.push(r):t.push(r)});var r;if(t.length>0){if(r=t,n.length>0){var o=new NestedMenuItem(new TextBlock("Премиальные начинки"),[new MenuItem(new ActionLink(new TextBlock("У меня нет столько денег"),()=>{o.remove()})).addClass("frustration-item")].concat(n)).setId("premium-menu");r.push(o)}}else r=n;return new NestedMenuItem(new TextBlock("Начинки"),r).render()},CafeMenu.prototype.renderToppingMenu=function(e){var t=e.map(e=>new MenuItem(new Container([new TextBlock(e.name+" "+e.price+" р. "+e.calories+" кал."),new ActionLink(new TextBlock("+"),()=>this.cafe.addTopping(e)).addClass("menu-item-button"),new ActionLink(new TextBlock("-"),()=>this.cafe.removeTopping(e)).addClass("menu-item-button")]).addClass("menu-item-container")));return new NestedMenuItem(new TextBlock("Топпинги"),t).render()},CafeMenu.prototype.render=function(){this.loadTypesData((e,t)=>{var n=this.loadingWrappers[e];n.onComplete(()=>{switch(e){case"hamburger":return this.renderHamburgerMenu(t);case"stuffing":return this.renderStuffingMenu(t);case"topping":return this.renderToppingMenu(t)}}),n.complete()});var e=[];return e.push(new MenuItem(new TextBlock("Меню:"))),this.types.forEach(t=>{e.push(this.loadingWrappers[t])}),e.push(new NestedMenuItem(new TextBlock("Купить"),[new MenuItem(new ActionLink(new TextBlock("Съем сейчас"),()=>{this.cafe.checkOut()})),new MenuItem(new ActionLink(new TextBlock("Положить в корзину"),()=>{this.cafe.checkOut()}))])),new CascadeMenu(e).render()},Gallery.prototype=Object.create(BaseUiElement.prototype),Gallery.prototype.constructor=Gallery,Gallery.prototype.loadPreviews=function(){var e=this;e.previewsLoaded||Http.get(e.sourceUrl,function(t,n){if(t)throw new Error(t);e.galleryData=n||[],e.loadingWrapper.complete(),e.previewsLoaded=!0})},Gallery.prototype.render=function(){var e=this;return e.previewsLoaded||e.loadPreviews(),e.loadingWrapper.onComplete(function(){var t=new Container;return e.galleryData.forEach(function(e){var n=new Image(e.thumb);n.addClass("preview"),n.setData("product-id",e.productId);var r=new ActionLink(n,function(){var t=new Image(e.full);Popup.show(t)});t.addChild(r.render())}),t.render()}),e.loadingWrapper.render()},LoadingWrapper.prototype=Object.create(BaseUiElement.prototype),LoadingWrapper.prototype.constructor=LoadingWrapper,LoadingWrapper.prototype.replacePlaceholder=function(e){if(this.placeholderElement&&(this.wrapper.removeChild(this.placeholderElement),this.wrapper.classList.remove("loading")),this.wrapper){var t=this.wrapper.parentNode;t.insertBefore(e(),this.wrapper),t.removeChild(this.wrapper)}},LoadingWrapper.prototype.render=function(){return this.wrapper=document.createElement("div"),this.isComplete&&this.completeContentProvider?this.completeContentProvider&&this.replacePlaceholder(this.completeContentProvider):(this.placeholderElement=BaseUiElement.renderSomething(this.placeholder),this.wrapper.appendChild(this.placeholderElement),this.wrapper.classList.add("loading")),this.isRendered=!0,this.wrapper},LoadingWrapper.prototype.complete=function(){this.isComplete=!0,this.completeContentProvider&&this.replacePlaceholder(this.completeContentProvider)},LoadingWrapper.prototype.onComplete=function(e){this.completeContentProvider=e,this.isComplete&&this.isRendered&&this.replacePlaceholder(this.completeContentProvider)},Http.get=function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState===XMLHttpRequest.DONE)if(200===n.status){var e=JSON.parse(n.responseText);t(null,e)}else{var r="Запрос выполнился с ошибкой, код: "+n.status;t(r,e)}},n.open("GET",e,!0),n.send()},UiException.prototype=Object.create(Error.prototype),UiException.prototype.constructor=UiException,BaseUiElement.renderSomething=function(e){if("String"==typeof e){var t=document.createElement("span");return t.innerHTML=e,t}if(e instanceof BaseUiElement)return e.render();if(e instanceof Node)return e;throw new UiException("Element cannot be rendered")},BaseUiElement.prototype.setId=function(e){return this.id=e,this},BaseUiElement.prototype.addClass=function(e){return this.classList.push(e),this},BaseUiElement.prototype.setData=function(e,t){this.data[e]=t},BaseUiElement.prototype.applyBaseProperties=function(e){this.id&&(e.id=this.id),this.classList.forEach(function(t){e.classList.add(t)}),Object.keys(this.data).forEach(t=>{e.setAttribute("data-"+t,this.data[t])})},BaseUiElement.prototype.render=function(){throw new UiException("Нельзя отрисовать абстрактный элемент.")},BaseUiElement.prototype.remove=function(){if(!this.id)throw new UiException("Нельзя удалить элемент с отсутствующим id.");var e=document.getElementById(this.id);if(!e)throw new UiException("Элемент с id="+this.id+" не добавлен в документ.");e.remove()},Container.prototype=Object.create(BaseUiElement.prototype),Container.prototype.constructor=Container,Container.prototype.renderWrapper=function(){return document.createElement("div")},Container.prototype.render=function(){var e=this;return this.container=this.renderWrapper(),this.applyBaseProperties(this.container),this.children.forEach(function(t){e.container.appendChild(BaseUiElement.renderSomething(t))}),this.container},Container.prototype.addChild=function(e){this.container?this.container.appendChild(BaseUiElement.renderSomething(el)):this.children.push(e)},Link.prototype=Object.create(BaseUiElement.prototype),Link.prototype.constructor=Link,Link.prototype.render=function(){var e=document.createElement("a");return this.applyBaseProperties(e),e.href=this.href,"String"==typeof this.content?e.innerHTML=this.content:this.content instanceof BaseUiElement&&e.appendChild(this.content.render()),e},TextBlock.prototype=Object.create(BaseUiElement.prototype),TextBlock.prototype.constructor=TextBlock,TextBlock.prototype.render=function(){var e=document.createElement("span");return this.applyBaseProperties(e),e.innerText=this.text,this.span=e,e},TextBlock.prototype.setText=function(e){this.text=e,this.span&&(this.span.innerText=this.text)},Image.prototype=Object.create(BaseUiElement.prototype),Image.prototype.constructor=Image,Image.prototype.render=function(){var e=document.createElement("img");return this.applyBaseProperties(e),e.src=this.source,e},ActionLink.prototype=Object.create(Link.prototype),ActionLink.prototype.baseRender=Link.prototype.render,ActionLink.prototype.constructor=ActionLink,ActionLink.prototype.render=function(){var e=this.baseRender();return e.onclick=this.action,e},Form.prototype=Object.create(Container.prototype),Form.prototype.create=Container,Form.prototype.renderWrapper=function(){var e=document.createElement("form");return e.action=this.url,e.method=this.method,e},FormRow.prototype=Object.create(BaseUiElement.prototype),FormRow.prototype.create=FormRow,FormRow.prototype.render=function(){var e=document.createElement("div");this.applyBaseProperties(e),e.classList.add("form-row");var t=document.createElement("div");t.classList.add("label-cell"),t.appendChild(this.label.render()),e.appendChild(t);var n=document.createElement("div");return n.classList.add("input-cell"),n.appendChild(this.input.render()),e.appendChild(n),this.input.id&&(this.label.for=this.input.id),e},Label.prototype=Object.create(BaseUiElement.prototype),Label.prototype.create=Label,Label.prototype.render=function(){var e=document.createElement("label");return e.innerHTML=this.text,e},Popup.show=function(e){var t=document.createElement("div");t.id="popup-overlay",t.classList.add("popup-overlay");var n=document.createElement("div");n.classList.add("popup"),"String"==typeof e?n.innerHTML=e:e instanceof BaseUiElement&&n.appendChild(e.render()),t.appendChild(n);var r=new ActionLink(new TextBlock("x"),function(){t.remove()});r.addClass("popup-close"),t.appendChild(r.render()),document.body.appendChild(t)},ShoppingBasketItem.prototype=Object.create(BaseUiElement.prototype),ShoppingBasketItem.prototype.constructor=ShoppingBasketItem,ShoppingBasketItem.prototype.render=function(){return document.createElement("li")},ShoppingBasketContent.prototype=Object.create(BaseUiElement.prototype),ShoppingBasketContent.prototype.constructor=ShoppingBasketContent,ShoppingBasketContent.prototype.render=function(){},ShoppingBasketPreview.prototype=Object.create(BaseUiElement.prototype),ShoppingBasketPreview.prototype.constructor=ShoppingBasketPreview,ShoppingBasketPreview.prototype.render=function(){var e;return new Container([e=new TextBlock("0").addClass("price"),new ActionLink(new Image("assets/shopping-cart.png"),function(){Popup.show(new ActionLink(new TextBlock("Увеличить счётчик"),function(){e.setText(parseInt(e.text)+1)}))})]).addClass("basket-preview").render()};var validationRules={name:{pattern:/[A-Za-zА-Яа-я]+/,hint:"Имя может состоять только из букв латинского или кириллического алфавита"},phone:{pattern:/\+7\(\d{3}\)\d{3}-\d{4}/,hint:"Телефон в формате +7(000)000-0000"},email:{pattern:/\w+[\w\.-]*@\w+[\w\.-]*\.\w{2,}/,hint:"Адрес почты должен быть в виде mymail@mail.ru, или my.mail@mail.ru, или my-mail@mail.ru"}};TextField.prototype=Object.create(BaseUiElement.prototype),TextField.prototype.constructor=TextField,TextField.prototype.render=function(){var e=document.createElement("span");if(e.classList.add("validation-wrapper"),this.applyBaseProperties(e),this.linesNumber>1)(t=document.createElement("textarea")).rows=this.linesNumber;else{var t=document.createElement("input");t.type="text"}t.name=this.name,t.placeholder=this.placeholder,e.appendChild(t);var n;return this.validationRule&&(e.setAttribute("data-validation-message",this.validationRule.hint),n=this.validationRule.pattern),t.addEventListener("input",function(t){n&&(this.value.length>0?n.test(this.value)?(e.classList.remove("invalid"),e.classList.add("valid")):(e.classList.add("invalid"),e.classList.remove("valid")):(e.classList.remove("valid"),e.classList.remove("invalid")))}),e};